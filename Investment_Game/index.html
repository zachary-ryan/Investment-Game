<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Investment Game</title>
<style>
    body {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #f0f0f5;
        margin: 0;
    }

    .game-container {
        width: 300px;
        padding: 20px;
        border-radius: 10px;
        background-color: #3366cc;
        color: #fff;
        text-align: center;
    }

    .info-bar {
        font-size: 0.9em;
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
    }

    .investment-card {
        background-color: #ffffff;
        color: #333;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 10px;
    }

    .investment-card h3 {
        margin: 5px 0;
        font-size: 1.1em;
        color: #3366cc;
    }

    .investment-card .value {
        font-size: 0.9em;
        margin-bottom: 5px;
    }

    input[type="number"], input[type="range"] {
        width: 100%;
    }

    input[type="range"] {
        margin-top: 5px;
    }

    .submit-button {
        background-color: #4CAF50;
        border: none;
        color: white;
        padding: 10px 20px;
        font-size: 1em;
        border-radius: 5px;
        cursor: pointer;
        width: 100%;
    }

    .submit-button:disabled {
        background-color: #888;
    }

    .message-area {
        margin-bottom: 10px;
        font-size: 0.9em;
        color: #fff;
    }
</style>
</head>
<body>

<div class="game-container">
    <div class="info-bar">
        <div>Budget Remaining: <span id="budget">$500</span></div>
        <div>Total Value: <span id="totalValue">0</span></div>
    </div>
    <h2>Period <span id="currentPeriod">1</span> of <span id="totalPeriods">10</span></h2>

    <div id="messageArea" class="message-area"></div>
    <div id="investmentCardsContainer"></div>
    <button id="submitButton" class="submit-button">Submit</button>
</div>

<script>
(() => {
    // Game data and variables
    const gameData = [];
    const gameId = `game_${Date.now()}`;
    let budget = 500;
    let totalValue = 0;
    let currentRound = 1;
    const totalRounds = 10;
    const numInvestmentCards = 1;
    let currentInvestmentData = generateInvestmentValues(numInvestmentCards);

    // UI elements
    const budgetElement = document.getElementById("budget");
    const totalValueElement = document.getElementById("totalValue");
    const currentPeriodElement = document.getElementById("currentPeriod");
    const totalPeriodsElement = document.getElementById("totalPeriods");
    const investmentCardsContainer = document.getElementById("investmentCardsContainer");
    const submitButton = document.getElementById("submitButton");
    const messageArea = document.getElementById("messageArea");

    // Update UI with initial values
    updateUI();

    // Event listener for the submit button
    submitButton.addEventListener('click', submitRound);

    // Generate initial investment cards
    resetInputs();

    // Function to update the UI elements
    function updateUI() {
        budgetElement.textContent = `$${budget.toLocaleString()}`;
        totalValueElement.textContent = totalValue;
        currentPeriodElement.textContent = currentRound;
        totalPeriodsElement.textContent = totalRounds;
    }

    // Function to generate random investment values and hidden costs
    function generateInvestmentValues(numCards) {
        const investmentData = [];
        for (let i = 0; i < numCards; i++) {
            const investmentValue = Math.floor(Math.random() * 100) + 1;
            const investmentCost = Math.floor(Math.random() * 100) + 1;
            investmentData.push({
                investmentValue,
                investmentCost
            });
        }
        return investmentData;
    }

    // Function to reset inputs and generate new investment cards
    function resetInputs() {
        investmentCardsContainer.innerHTML = '';
        currentInvestmentData.forEach((data, index) => {
            const maxRange = 100; // User can invest between $0 and $100 per card

            const cardDiv = document.createElement('div');
            cardDiv.className = 'investment-card';

            const cardHtml = `
                <h3>Investment ${index + 1}</h3>
                <div class="value">Value: $${data.investmentValue}</div>
                <input type="number" id="investmentInput${index}" min="0" max="${maxRange}" placeholder="Enter Amount">
                <div class="slider-container">
                    <input type="range" id="investmentSlider${index}" min="0" max="${maxRange}">
                </div>
            `;
            cardDiv.innerHTML = cardHtml;

            investmentCardsContainer.appendChild(cardDiv);

            const inputElement = cardDiv.querySelector(`#investmentInput${index}`);
            const sliderElement = cardDiv.querySelector(`#investmentSlider${index}`);

            // Synchronize input and slider values
            inputElement.addEventListener('input', () => {
                sliderElement.value = inputElement.value;
            });

            sliderElement.addEventListener('input', () => {
                inputElement.value = sliderElement.value;
            });
        });
    }

    // Function to handle the submission of each round
    function submitRound() {
        let totalRoundValue = 0;
        let totalRoundCost = 0;
        let messages = [];

        for (let i = 0; i < currentInvestmentData.length; i++) {
            const inputElement = document.getElementById(`investmentInput${i}`);
            const investmentAmount = parseInt(inputElement.value) || 0;
            const investmentValue = currentInvestmentData[i].investmentValue;
            const investmentCost = currentInvestmentData[i].investmentCost;

            if (investmentAmount < 0 || investmentAmount > 100) {
                messages.push(`Investment ${i + 1}: Amount must be between $0 and $100.`);
                continue;
            }

            totalRoundCost += investmentAmount;

            if (investmentAmount >= investmentCost) {
                totalRoundValue += investmentValue;
                messages.push(`Investment ${i + 1} successful! Added $${investmentValue} to total value.`);
            } else {
                messages.push(`Investment ${i + 1} failed. Your bid of $${investmentAmount} was less than the required cost.`);
            }
        }

        // Validate if the total investment exceeds the budget
        if (totalRoundCost > budget) {
            messages = ['You have exceeded your remaining budget. Please adjust your investments.'];
            messageArea.innerHTML = messages.join('<br>');
            return;
        }

        // Update total value and budget
        totalValue += totalRoundValue;
        budget -= totalRoundCost;

        // Update UI with new budget and value
        updateUI();

        // Save round data
        saveRoundData(currentRound, totalRoundValue, totalRoundCost, currentInvestmentData, budget, totalValue);

        // Display messages
        messageArea.innerHTML = messages.join('<br>');

        if (currentRound < totalRounds) {
            // Move to the next round
            currentRound++;
            currentPeriodElement.textContent = currentRound;

            // Generate new investment data for next round and reset inputs
            currentInvestmentData = generateInvestmentValues(numInvestmentCards);
            resetInputs();
        } else {
            saveGameResults();
        }
    }

    // Function to save data for each round
    function saveRoundData(round, totalRoundValue, totalRoundCost, investmentData, remainingBudget, totalValue) {
        investmentData.forEach((data, index) => {
            gameData.push({
                GameID: gameId,
                Round: round,
                Card: index + 1,
                ValueDisplayed: data.investmentValue,
                UserSpent: parseInt(document.getElementById(`investmentInput${index}`).value) || 0,
                ActualCost: data.investmentCost,
                RemainingBudget: remainingBudget,
                TotalValue: totalValue
            });
        });
    }

    // Function to convert game data to CSV format
    function convertToCSV(data) {
        const headers = [
            "GameID", "Round", "Card", "ValueDisplayed", "UserSpent", "ActualCost", "RemainingBudget", "TotalValue"
        ];

        const csvRows = data.map(row => headers.map(header => row[header]).join(","));
        return [headers.join(","), ...csvRows].join("\n");
    }

    // Function to download CSV file
    function downloadCSV(filename, csvContent) {
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.setAttribute("hidden", "");
        a.setAttribute("href", url);
        a.setAttribute("download", filename);
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }

    // Function to save game results after the final round
    function saveGameResults() {
        const saveConfirmation = confirm("Would you like to save your game results?");
        if (saveConfirmation) {
            const csvContent = convertToCSV(gameData);
            const filename = `game_results.csv`;
            downloadCSV(filename, csvContent);
            alert("Your game results have been saved.");
        } else {
            alert("Game results were not saved.");
        }
    }
})();
</script>

</body>
</html>
